<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORST BILLIONAIRE 2025</title>
    <meta name="description" content="The people's tournament to crown 2025's worst billionaire. Vote now.">
    <meta property="og:title" content="WORST BILLIONAIRE 2025">
    <meta property="og:description" content="16 billionaires. 4 rounds. 1 champion of greed. The people decide.">
    <meta property="og:image" content="https://placehold.co/1200x630/0d0d0d/ff2a2a?text=WORST%0ABILLIONAIRE%0A2025&font=Anton">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Instrument+Serif&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0d0d0d;
            --fg: #fafafa;
            --red: #ff2a2a;
            --red-dark: #cc0000;
            --red-glow: rgba(255, 42, 42, 0.4);
            --gold: #ffd700;
            --green: #00ff7f;
            --gray: #666;
            --gray-light: #999;
            --border: rgba(255,255,255,0.08);
        }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Space Grotesk', system-ui, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.5;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Animated background */
        .bg-noise {
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 0;
        }
        
        .bg-gradient {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at 50% 0%, rgba(255,42,42,0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Layout */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            padding: 60px 0 50px;
            text-align: center;
            position: relative;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,42,42,0.1);
            border: 1px solid rgba(255,42,42,0.3);
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--red);
            margin-bottom: 30px;
        }
        
        .badge .dot {
            width: 6px;
            height: 6px;
            background: var(--red);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .logo {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: clamp(3.5rem, 14vw, 9rem);
            font-weight: 400;
            line-height: 0.85;
            letter-spacing: -0.03em;
            margin-bottom: 25px;
        }
        
        .logo .worst {
            display: block;
            color: var(--red);
        }
        
        .logo .billionaire {
            display: block;
            color: var(--fg);
        }
        
        .tagline {
            font-size: 1.1rem;
            color: var(--gray-light);
            max-width: 420px;
            margin: 0 auto;
        }
        
        /* Status strip */
        .status-strip {
            display: flex;
            justify-content: center;
            gap: 50px;
            padding: 25px 0;
            margin: 30px 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-label {
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: var(--gray);
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        
        .status-value {
            font-family: 'Instrument Serif', serif;
            font-size: 1.6rem;
        }
        
        .status-value.live { color: var(--green); }
        .status-value.red { color: var(--red); }
        
        /* Countdown */
        .countdown-wrap {
            text-align: center;
            padding: 40px 0;
        }
        
        .countdown-label {
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.2em;
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        .countdown {
            display: flex;
            justify-content: center;
            gap: 25px;
        }
        
        .countdown-block {
            text-align: center;
        }
        
        .countdown-num {
            font-family: 'Instrument Serif', serif;
            font-size: 3.5rem;
            line-height: 1;
            color: var(--red);
        }
        
        .countdown-unit {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Section headers */
        .section-header {
            text-align: center;
            margin: 60px 0 40px;
        }
        
        .section-title {
            font-family: 'Instrument Serif', serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .section-subtitle {
            color: var(--gray-light);
            font-size: 1rem;
        }
        
        /* Matchup cards */
        .matchups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .matchup-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.3s, transform 0.3s;
        }
        
        .matchup-card:hover {
            border-color: rgba(255,255,255,0.15);
        }
        
        .matchup-card.complete {
            opacity: 0.7;
        }
        
        .matchup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--border);
        }
        
        .matchup-num {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--gray);
        }
        
        .matchup-status {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }
        
        .matchup-status.open { color: var(--green); }
        .matchup-status.voted { color: var(--gold); }
        .matchup-status.closed { color: var(--gray); }
        
        .matchup-body {
            padding: 15px;
        }
        
        .candidate {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.02);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .candidate:last-child {
            margin-bottom: 0;
        }
        
        .candidate:hover {
            background: rgba(255,42,42,0.05);
            border-color: rgba(255,42,42,0.3);
        }
        
        .candidate.selected {
            background: rgba(255,42,42,0.1);
            border-color: var(--red);
        }
        
        .candidate.winner {
            background: rgba(255,215,0,0.1);
            border-color: var(--gold);
        }
        
        .candidate.loser {
            opacity: 0.4;
        }
        
        .candidate.disabled {
            cursor: default;
            pointer-events: none;
        }
        
        .candidate-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--red), #ff6b6b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Instrument Serif', serif;
            font-size: 1.4rem;
            color: white;
            flex-shrink: 0;
        }
        
        .candidate-info {
            flex: 1;
            min-width: 0;
        }
        
        .candidate-name {
            font-weight: 700;
            font-size: 1.05rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .candidate-meta {
            font-size: 0.8rem;
            color: var(--gray-light);
        }
        
        .candidate-check {
            width: 28px;
            height: 28px;
            border: 2px solid var(--gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .candidate.selected .candidate-check {
            border-color: var(--red);
            background: var(--red);
            color: white;
        }
        
        .candidate.winner .candidate-check {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--bg);
        }
        
        /* Results bar */
        .results-bar {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .result-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .result-row:last-child {
            margin-bottom: 0;
        }
        
        .result-name {
            width: 80px;
            font-size: 0.8rem;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .result-track {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .result-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease-out;
        }
        
        .result-fill.winner { background: var(--gold); }
        .result-fill.loser { background: var(--gray); }
        
        .result-pct {
            width: 45px;
            text-align: right;
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        .result-pct.winner { color: var(--gold); }
        
        /* Expand button for sins */
        .sins-toggle {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--gray-light);
            font-family: inherit;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sins-toggle:hover {
            background: rgba(255,255,255,0.05);
            color: var(--fg);
        }
        
        .sins-content {
            display: none;
            padding: 15px;
            margin-top: 10px;
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        
        .sins-content.show {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .sins-content h4 {
            color: var(--red);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .sins-content p {
            color: var(--gray-light);
            margin-bottom: 12px;
        }
        
        .sins-content p:last-child {
            margin-bottom: 0;
        }
        
        .sins-content strong {
            color: var(--fg);
        }
        
        /* Submit section */
        .submit-section {
            text-align: center;
            padding: 50px 0;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        
        .votes-summary {
            font-size: 1rem;
            color: var(--gray-light);
            margin-bottom: 25px;
        }
        
        .votes-summary strong {
            color: var(--fg);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 18px 40px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-large {
            padding: 22px 50px;
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: var(--red);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--red-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--red-glow);
        }
        
        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.05);
            color: var(--fg);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Thank you / results unlock */
        .thank-you {
            display: none;
            text-align: center;
            padding: 80px 20px;
        }
        
        .thank-you.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .thank-you-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .thank-you-title {
            font-family: 'Instrument Serif', serif;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .thank-you-text {
            color: var(--gray-light);
            max-width: 500px;
            margin: 0 auto 40px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        /* Email form */
        .email-form {
            max-width: 420px;
            margin: 0 auto;
            text-align: left;
        }
        
        .form-title {
            font-family: 'Instrument Serif', serif;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .form-field {
            margin-bottom: 15px;
        }
        
        .form-input {
            width: 100%;
            padding: 16px 18px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--fg);
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--red);
        }
        
        .form-input::placeholder {
            color: var(--gray);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
        }
        
        .form-checkbox input {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: var(--red);
            flex-shrink: 0;
        }
        
        .form-checkbox label {
            font-size: 0.9rem;
            color: var(--gray-light);
            line-height: 1.5;
        }
        
        .form-submit {
            width: 100%;
            margin-top: 10px;
        }
        
        .form-skip {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .form-skip:hover {
            color: var(--fg);
        }
        
        /* Share strip */
        .share-strip {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 30px 0;
            flex-wrap: wrap;
        }
        
        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 24px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--fg);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .share-btn:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.2);
        }
        
        .share-btn.twitter:hover { border-color: #1DA1F2; color: #1DA1F2; }
        .share-btn.facebook:hover { border-color: #4267B2; color: #4267B2; }
        .share-btn.copy:hover { border-color: var(--green); color: var(--green); }
        
        /* Winner banner */
        .winner-section {
            text-align: center;
            padding: 100px 20px;
            position: relative;
        }
        
        .winner-section::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at center, rgba(255,215,0,0.1), transparent 70%);
            pointer-events: none;
        }
        
        .winner-label {
            font-size: 0.8rem;
            font-weight: 700;
            letter-spacing: 0.3em;
            color: var(--gold);
            margin-bottom: 20px;
        }
        
        .winner-trophy {
            font-size: 100px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .winner-name {
            font-family: 'Instrument Serif', serif;
            font-size: clamp(3rem, 12vw, 7rem);
            line-height: 1;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--gold), var(--red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .winner-stats {
            font-size: 1.2rem;
            color: var(--gray-light);
        }
        
        .winner-stats strong {
            color: var(--gold);
        }
        
        /* Past rounds accordion */
        .past-rounds {
            margin: 60px 0;
        }
        
        .past-round {
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .past-round-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: rgba(255,255,255,0.02);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .past-round-header:hover {
            background: rgba(255,255,255,0.04);
        }
        
        .past-round-title {
            font-weight: 700;
        }
        
        .past-round-meta {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .past-round-toggle {
            font-size: 1.2rem;
            color: var(--gray);
            transition: transform 0.3s;
        }
        
        .past-round.open .past-round-toggle {
            transform: rotate(180deg);
        }
        
        .past-round-content {
            display: none;
            padding: 20px 25px;
            border-top: 1px solid var(--border);
        }
        
        .past-round.open .past-round-content {
            display: block;
        }
        
        .past-matchup {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .past-matchup:last-child {
            margin-bottom: 0;
        }
        
        .past-matchup-icon {
            font-size: 1.2rem;
        }
        
        .past-matchup-info {
            flex: 1;
        }
        
        .past-matchup-winner {
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .past-matchup-loser {
            font-size: 0.85rem;
            color: var(--gray);
            text-decoration: line-through;
        }
        
        .past-matchup-votes {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 60px 20px;
            border-top: 1px solid var(--border);
            margin-top: 80px;
        }
        
        .footer-text {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .footer-link {
            color: var(--red);
            text-decoration: none;
        }
        
        .footer-link:hover {
            text-decoration: underline;
        }
        
        /* Confetti canvas */
        #confetti {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1000;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .status-strip { gap: 30px; }
            .matchups-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .countdown { gap: 15px; }
            .countdown-num { font-size: 2.5rem; }
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--border) 25%, rgba(255,255,255,0.08) 50%, var(--border) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Hidden forms for Netlify detection (required for JS-rendered forms) -->
    <form name="notify-signup" netlify netlify-honeypot="bot-field" hidden>
        <input type="text" name="bot-field">
        <input type="email" name="email">
        <input type="text" name="opt-in">
        <input type="text" name="signup-type">
    </form>
    <form name="voter-signup" netlify netlify-honeypot="bot-field" hidden>
        <input type="text" name="bot-field">
        <input type="email" name="email">
        <input type="text" name="name">
        <input type="text" name="zip">
        <input type="text" name="opt-in">
        <input type="text" name="signup-type">
    </form>
    <form name="round-notify" netlify netlify-honeypot="bot-field" hidden>
        <input type="text" name="bot-field">
        <input type="email" name="email">
        <input type="text" name="opt-in">
        <input type="text" name="signup-type">
    </form>
    
    <div class="bg-noise"></div>
    <div class="bg-gradient"></div>
    <canvas id="confetti"></canvas>
    
    <div class="container">
        <header>
            <div class="badge">
                <span class="dot"></span>
                <span id="badgeText">VOTING OPEN</span>
            </div>
            
            <h1 class="logo">
                <span class="worst">Worst</span>
                <span class="billionaire">Billionaire</span>
            </h1>
            
            <p class="tagline">They bought the government. They bought the media. They can't buy your vote.</p>
        </header>
        
        <div class="status-strip">
            <div class="status-item">
                <div class="status-label">Round</div>
                <div class="status-value red" id="roundDisplay">‚Äî</div>
            </div>
            <div class="status-item">
                <div class="status-label">Total Votes</div>
                <div class="status-value" id="votesDisplay">‚Äî</div>
            </div>
            <div class="status-item">
                <div class="status-label">Status</div>
                <div class="status-value live" id="statusDisplay">‚Äî</div>
            </div>
        </div>
        
        <main id="mainContent">
            <!-- Content loaded dynamically -->
        </main>
        
        <footer>
            <p class="footer-text">
                A project about billionaire accountability ¬∑ <a href="#" class="footer-link" onclick="showPrivacy(); return false;">Privacy</a>
            </p>
        </footer>
    </div>

    <script>
    // ==========================================
    // CONFIG
    // ==========================================
    const CONFIG = {
        // Cloudflare Worker API URL
        apiUrl: 'https://worst-billionaires-api.rvkgq2t45r.workers.dev',
        
        // LOCAL TESTING DATES - Set to current time for easy testing
        // TODO: Update these to production dates before deploying
        rounds: [
            { name: 'Round of 16', start: '2025-12-29T00:00:00', end: '2026-01-05T23:59:59' },
            { name: 'Quarterfinals', start: '2026-01-06T00:00:00', end: '2026-01-13T23:59:59' },
            { name: 'Semifinals', start: '2026-01-14T00:00:00', end: '2026-01-21T23:59:59' },
            { name: 'Final', start: '2026-01-22T00:00:00', end: '2026-01-29T23:59:59' }
        ],
        
        canonicalUrl: 'https://fuck2025.org',

        // Demo mode - set to false for production
        demo: false,
        demoRound: 1
    };

// Voting schedule for display (human-readable)
const SCHEDULE = [
    { label: "Round of 16", dates: "Dec 24 ‚Äì Jan 5" },
    { label: "Quarterfinals", dates: "Jan 6 ‚Äì Jan 9" },
    { label: "Semifinals", dates: "Jan 10 ‚Äì Jan 12" },
    { label: "Final", dates: "Jan 13 ‚Äì Jan 16" }
];

// Returns the canonical URL for sharing
function canonicalUrl() {
    return CONFIG.canonicalUrl || window.location.origin;
}

// Renders the schedule and a short explainer about the tournament.
function renderScheduleAndExplainer() {
    return `
        <div class="card" style="margin: 20px 0 30px; padding: 18px; border: 1px solid var(--border); border-radius: 8px;">
            <div style="font-weight:800; letter-spacing:0.08em; font-size:0.78rem; color: var(--gray);">SCHEDULE</div>
            <div style="margin-top:10px; display:grid; gap:8px;">
                ${SCHEDULE.map(r => `
                    <div style="display:flex; justify-content:space-between; gap:12px;">
                        <div style="font-weight:700;">${r.label}</div>
                        <div style="color: var(--gray-light);">${r.dates}</div>
                    </div>
                `).join('')}
            </div>
            <div style="margin-top:16px; border-top:1px solid var(--border); padding-top:14px;">
                <div style="font-weight:800; letter-spacing:0.08em; font-size:0.78rem; color: var(--gray);">HOW VOTING WORKS</div>
                <ul style="margin:10px 0 0 18px; color: var(--gray-light); line-height:1.55;">
                    <li>Pick the ‚Äúworst‚Äù billionaire in as many matchups as you want.</li>
                    <li>Submit once per round (your device gets a unique voter ID).</li>
                    <li>Winners advance. Results unlock after you vote.</li>
                </ul>
            </div>
        </div>
    `;
}

// Social sharing helpers
function shareLinkedIn() {
    const url = encodeURIComponent(canonicalUrl());
    const text = encodeURIComponent("Vote in Worst Billionaire 2025.");
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${text}`, "_blank");
}
function shareReddit() {
    const url = encodeURIComponent(canonicalUrl());
    const title = encodeURIComponent("Worst Billionaire 2025 ‚Äî vote now");
    window.open(`https://www.reddit.com/submit?url=${url}&title=${title}`, "_blank");
}
function shareBluesky() {
    const text = encodeURIComponent(`Worst Billionaire 2025 ‚Äî vote now: ${canonicalUrl()}`);
    window.open(`https://bsky.app/intent/compose?text=${text}`, "_blank");
}
function shareEmail() {
    const subject = encodeURIComponent("Vote: Worst Billionaire 2025");
    const body = encodeURIComponent(`Vote here: ${canonicalUrl()}`);
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

// Generate and download a shareable image with current matchup info
function downloadShareImage() {
    const round = getCurrentRound();
    let roundName;
    switch (round) {
        case 1: roundName = "Round of 16"; break;
        case 2: roundName = "Quarterfinals"; break;
        case 3: roundName = "Semifinals"; break;
        case 4: roundName = "Final"; break;
        default: roundName = "Tournament";
    }
    // Default names and avatars
    let a = "Billionaire A", b = "Billionaire B", avA = "üí∞", avB = "ü™ô";
    try {
        const matchups = Object.values(state.tournamentData?.matchups || {});
        if (matchups.length) {
            const first = matchups[0];
            if (first?.candidates?.length === 2) {
                const [idA, idB] = first.candidates;
                a = BILLIONAIRES[idA]?.name || a;
                b = BILLIONAIRES[idB]?.name || b;
                avA = BILLIONAIRES[idA]?.avatar || avA;
                avB = BILLIONAIRES[idB]?.avatar || avB;
            }
        }
    } catch (_) {}
    const canvas = document.createElement("canvas");
    canvas.width = 1200;
    canvas.height = 630;
    const ctx = canvas.getContext("2d");
    // Background
    ctx.fillStyle = "#0b0b0b";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // Title
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 64px system-ui, -apple-system, Segoe UI, Roboto";
    ctx.fillText("WORST BILLIONAIRE 2025", 70, 120);
    // Round
    ctx.fillStyle = "#bdbdbd";
    ctx.font = "bold 28px system-ui, -apple-system, Segoe UI, Roboto";
    ctx.fillText(`${roundName} ¬∑ Vote now`, 70, 170);
    // Matchup text
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 44px system-ui, -apple-system, Segoe UI, Roboto";
    ctx.fillText(`${avA}  ${a}`, 70, 280);
    ctx.fillText(`vs`, 70, 350);
    ctx.fillText(`${avB}  ${b}`, 70, 420);
    // URL
    ctx.fillStyle = "#7ddc6f";
    ctx.font = "bold 28px system-ui, -apple-system, Segoe UI, Roboto";
    const urlText = canonicalUrl().replace(/^https?:\/\//, "");
    ctx.fillText(urlText, 70, 540);
    // Download
    const aTag = document.createElement("a");
    aTag.href = canvas.toDataURL("image/png");
    aTag.download = "worst-billionaire-2025.png";
    aTag.click();
}
    
    // ==========================================
    // BILLIONAIRE DATA
    // ==========================================
        const BILLIONAIRES = {
        musk: {
        name: "Elon Musk",
        short: "Musk",
        company: "Tesla ¬∑ SpaceX ¬∑ X",
        worth: "$449B",
        avatar: "EM",
        tagline: "Bought the government. Now he runs it.",
        sins: `Spent <strong>$288 million</strong> electing Trump‚Äîthe largest individual political donation in U.S. history. Now runs DOGE from a White House office, cutting agencies that regulate his own companies while his $15 billion in government contracts remain untouched.
        
        His companies face <strong>30+ federal investigations</strong> across 11 agencies. Those agencies? He's gutting them. The SEC sued him for fraud‚Äîhe's now dismantling the SEC. The NLRB is prosecuting SpaceX for illegal firings‚Äîhe tried to cancel their lease. Starlink terminals are being installed across federal buildings at taxpayer expense.
        
        Made what appeared to be a <strong>Nazi salute</strong> at Trump's inauguration rally. Tesla sales down 45% in Europe as the brand becomes toxic. Called a rescue diver a "pedo" and spread election conspiracy theories to his 200 million followers. The richest man in history, now with government power and zero oversight.`
        },
        trump: {
        name: "Donald Trump",
        short: "Trump",
        company: "Trump Org ¬∑ $TRUMP Coin",
        worth: "$5.5B",
        avatar: "DT",
        tagline: "Convicted felon. Current president. Crypto grifter.",
        sins: `<strong>34-count convicted felon</strong> now serving as President. His net worth jumped $3.2 billion since taking office‚Äîthe most brazen presidential profiteering in American history. Launched the $TRUMP memecoin days before inauguration, making his family <strong>$800+ million</strong> in 2025.
        
        Purchased <strong>$103 million in corporate bonds</strong> from companies his policies directly affect. Pardoned crypto criminals who enriched his family. Accepted a $2 billion UAE investment in his crypto company days before signing favorable AI chip export deals. The corruption is so open it makes Teapot Dome look quaint.
        
        Fired inspectors general investigating his allies. Ended anti-corruption investigations. His Treasury is rewriting tax law to benefit "giant private equity firms, crypto companies, and multinational corporations." 91 felony charges across four cases‚Äîand he's above the law.`
        },
        sacks: {
        name: "David Sacks",
        short: "Sacks",
        company: "Craft Ventures ¬∑ White House",
        worth: "$1.5B",
        avatar: "DS",
        tagline: "The crypto czar writing his own rules.",
        sins: `Trump's <strong>"AI & Crypto Czar"</strong>‚Äîan unelected billionaire shaping policy for industries he's invested in. When Trump announced a strategic crypto reserve including Solana, critics noted Sacks had made <strong>$1 billion</strong> on Solana investments. He claims he divested. His fund still holds crypto companies.
        
        Given a <strong>blanket ethics waiver</strong> allowing him to work on matters affecting his financial holdings. The waiver came after Trump fired the head of the Office of Government Ethics. His job: light-touch regulation of crypto‚Äîan industry that donated massively to Trump.
        
        Called for the government to bail out Silicon Valley Bank when his portfolio was at risk. Now pushing to preempt state AI safety laws that his investments lobbied against. Steve Bannon called his approach "more regulations to open a nail salon than for dangerous AI technology."`
        },
        sun: {
        name: "Justin Sun",
        short: "Sun",
        company: "Tron ¬∑ World Liberty Financial",
        worth: "$8.5B",
        avatar: "JS",
        tagline: "Bought a pardon with a $75 million investment.",
        sins: `Chinese crypto billionaire facing <strong>SEC fraud charges</strong>‚Äîuntil he invested $75 million in Trump's World Liberty Financial. The SEC mysteriously paused its case. He went from avoiding U.S. soil for fear of arrest to VIP guest at Trump's private crypto dinner.
        
        Paid <strong>$6.2 million for a banana duct-taped to a wall</strong>‚Äîthen ate it. His Tron network is linked to criminal organizations; one researcher estimates half of all illegal crypto activity runs through it. He's bragged about his connections to the Chinese Communist Party.
        
        Now Trump's crypto "guardian angel," reportedly planning to take Tron public through a Trump-connected investment bank. The SEC charges he "fraudulently inflated" crypto prices and made $31 million in "illegal proceeds"‚Äîcharges conveniently on hold while Trump is president.`
        },
        adelson: {
        name: "Miriam Adelson",
        short: "Adelson",
        company: "Las Vegas Sands ¬∑ Dallas Mavericks",
        worth: "$35B",
        avatar: "MA",
        tagline: "$250 million buys a lot of foreign policy.",
        sins: `Gave <strong>$250 million</strong> to elect Trump‚Äîmore than any other donor. When Trump asked whether she loves Israel or America more, she refused to answer. "That means that might be an issue," Trump joked. She's shaped U.S. Middle East policy through checkbook diplomacy.
        
        At a White House Hanukkah party, she urged Trump to <strong>run for a third term</strong>‚Äîopenly discussing schemes with Jeffrey Epstein-linked lawyer Alan Dershowitz. She offered another $250 million if he does. The Constitution is apparently negotiable when you're this rich.
        
        Her late husband said he was a "one-issue person: Israel." She's continued the mission, pushing for West Bank annexation. She wrote that "Black Lives Matter activists" and critics of Israel "should be dead to us." Her 25-year union-busting campaign at the Venetian made it the only non-union casino on the Vegas Strip.`
        },
        bezos: {
        name: "Jeff Bezos",
        short: "Bezos",
        company: "Amazon ¬∑ Washington Post",
        worth: "$256B",
        avatar: "JB",
        tagline: "Killed democracy. Dies in darkness.",
        sins: `Personally <strong>killed the Washington Post's endorsement</strong> of Kamala Harris, overruling his own editorial board in an unprecedented intervention. 250,000 subscribers cancelled. Democracy dies in darkness‚Äîunless it's bad for business.
        
        Paid <strong>$40 million</strong> for a Melania Trump documentary with "full creative control" for the Trumps. Amazon donated $1 million to the inauguration. After years of Trump attacks, Bezos learned the lesson: bend the knee or face the consequences.
        
        World's largest retailer built on <strong>warehouse workers denied bathroom breaks</strong>, forced to pee in bottles, monitored by AI for "time off task." Fired workers who tried to unionize. Added $100 billion to his fortune during the pandemic while his workers got $2/hour hazard pay‚Äîbriefly.`
        },
        zuckerberg: {
        name: "Mark Zuckerberg",
        short: "Zuck",
        company: "Meta (Facebook ¬∑ Instagram)",
        worth: "$229B",
        avatar: "MZ",
        tagline: "Ended fact-checking. Embraced the chaos.",
        sins: `<strong>Eliminated fact-checking entirely</strong> on Facebook and Instagram in January 2025. Called it "censorship" after years of defending it. The real reason: Trump threatened to throw him in prison, then won, and Zuck showed up at Mar-a-Lago to kiss the ring.
        
        Sat next to Trump at state dinners. Donated <strong>$1 million to the inauguration</strong>. Changed content policies to allow more hate speech. Replaced diverse board members. The transformation from "connecting the world" to MAGA court jester took about 90 days.
        
        Built the <strong>largest surveillance advertising machine</strong> in history. Facebook fueled genocide in Myanmar, spread COVID misinformation, and helped January 6th organizers. His "pivot to the metaverse" burned $50 billion. His pivot to Trump was free.`
        },
        andreessen: {
        name: "Marc Andreessen",
        short: "Andreessen",
        company: "Andreessen Horowitz (a16z)",
        worth: "$1.7B",
        avatar: "MA",
        tagline: "The tech bro whisperer in Trump's ear.",
        sins: `Donated <strong>$33+ million</strong> to elect Trump and install cronies across the government. His venture firm invested in 8 companies under CFPB investigation‚Äînow DOGE is dismantling the CFPB. Coincidence? His portfolio companies' regulatory problems are disappearing.
        
        Leaked messages show him telling White House officials that universities will <strong>"pay the price"</strong> for DEI policies. "My people are furious and not going to take it anymore," he wrote about white conservatives. He's quietly become one of the most powerful voices in the administration.
        
        Published a "Techno-Optimist Manifesto" calling socialism and regulation "the enemy." His firm backed LendUp, which the CFPB found <strong>bilked customers by hiding fees</strong>. His solution? Destroy the CFPB. Now he's pushing to preempt all state AI safety laws.`
        },
        ellison: {
        name: "Larry Ellison",
        short: "Ellison",
        company: "Oracle ¬∑ Paramount/CBS",
        worth: "$259B",
        avatar: "LE",
        tagline: "Bought CBS. Cancelled the critics.",
        sins: `Bought Paramount to <strong>reshape CBS News</strong> to be friendlier to Trump. First move: cancelled Stephen Colbert's show. Installing an "ombudsman" to monitor broadcasts for "liberal bias." Trump calls him "CEO of everything."
        
        Close friends with Elon Musk‚Äîthey vacation together, invest together, and now govern together. Oracle provides cloud infrastructure for TikTok (saved by Trump's executive order) and is angling for <strong>massive AI government contracts</strong>.
        
        Third-richest person on Earth, made his money on database software, then on government contracts. His Hawaii island compound and superyachts are monuments to extreme wealth while Oracle fights paying taxes. The media mogul era of Murdoch is ending. Ellison's is beginning.`
        },
        thiel: {
        name: "Peter Thiel",
        short: "Thiel",
        company: "Palantir ¬∑ Founders Fund",
        worth: "$20.8B",
        avatar: "PT",
        tagline: "The surveillance capitalist who bankrolled MAGA.",
        sins: `Palantir's surveillance technology is used by <strong>ICE to track immigrants</strong>, militaries to target drone strikes, and police departments nationwide. Now DOGE is reportedly using Palantir to surveil federal workers. He's the shadow architect of the tech-surveillance state.
        
        Bankrolled JD Vance's political career from venture capital to Vice President. His network of proteges‚Äîthe "PayPal Mafia"‚Äînow runs the government. He once wrote that <strong>women's suffrage was bad for democracy</strong>. He funds "seasteading" to escape government entirely.
        
        Destroyed Gawker by secretly funding lawsuits‚Äîa billionaire using the courts to silence journalism. Connected to Jeffrey Epstein through multiple networking events. His worldview: democracy is overrated, technology should rule, and he should be the one writing the code.`
        },
        zhao: {
        name: "Changpeng Zhao",
        short: "CZ",
        company: "Binance",
        worth: "$60B",
        avatar: "CZ",
        tagline: "Pardoned for money laundering. Back in business.",
        sins: `Founded the world's largest crypto exchange, which the DOJ found <strong>enabled money laundering for terrorists and criminals</strong>. Pleaded guilty. Served four months. Then Trump gave him a full pardon‚Äîweeks after Binance helped broker a $2 billion deal for Trump's crypto company.
        
        The Justice Department said Binance caused <strong>"significant harm to U.S. national security"</strong> by letting criminals, including sanctions evaders and child exploitation networks, freely use the platform. He paid a $4.3 billion fine. Now he's free and clear.
        
        Binance processed 90% of the UAE's $2 billion investment in Trump's World Liberty Financial. The SEC dropped remaining charges. The pardon came five months later. The corruption is so obvious it barely needs explanation‚Äîmoney flowed to Trump, charges disappeared.`
        },
        murdoch: {
        name: "Rupert Murdoch",
        short: "Murdoch",
        company: "News Corp ¬∑ Fox News",
        worth: "$21.2B",
        avatar: "RM",
        tagline: "Built the disinformation machine. Still running it.",
        sins: `<strong>Highest disapproval rating (55%)</strong> of any billionaire on Earth. Decades of weaponized disinformation through Fox News. Settled the Dominion lawsuit for $787 million after his network knowingly spread election lies‚Äîtexts showed hosts calling the claims "insane."
        
        At 93, he's still controlling the conservative media machine that made Trump possible. His newspapers and networks push climate denial, immigrant fear-mongering, and culture war outrage across three continents. <strong>Democracy's most persistent termite</strong>.
        
        Fox News hosts privately mocked Trump as "demonic" and "insane" while publicly amplifying him. Murdoch himself texted that the election fraud claims were "really crazy." Then they aired them anyway. The settlement was pocket change. The damage is permanent.`
        },
        schwarzman: {
        name: "Stephen Schwarzman",
        short: "Schwarzman",
        company: "Blackstone",
        worth: "$52.6B",
        avatar: "SS",
        tagline: "The landlord driving the housing crisis.",
        sins: `The <strong>United Nations formally condemned</strong> Blackstone's housing practices for "devastating impacts" on the right to housing. The world's largest corporate landlord, buying up neighborhoods, raising rents, and fueling the affordability crisis.
        
        Called proposed tax reform <strong>"like when Hitler invaded Poland."</strong> For context: closing tax loopholes on private equity billionaires = Nazi invasion. He made over $1 billion again in 2024 while his tenants face eviction.
        
        Close Trump ally and megadonor. Blackstone tenants report aggressive rent increases, maintenance neglect, and rapid evictions. His business model: buy housing, maximize extraction, repeat. The American Dream, owned by private equity.`
        },
        adani: {
        name: "Gautam Adani",
        short: "Adani",
        company: "Adani Group",
        worth: "$85B",
        avatar: "GA",
        tagline: "Indicted in America. Untouchable in India.",
        sins: `<strong>Indicted by the U.S. Department of Justice</strong> for a $250 million bribery scheme‚Äîaccused of paying Indian government officials for solar energy contracts and misleading American investors. Facing securities fraud charges.
        
        Hindenburg Research called Adani Group <strong>"the largest con in corporate history"</strong>‚Äîa "brazen stock manipulation and accounting fraud scheme." His companies lost $150 billion in value after the report. He's still India's richest man.
        
        Close ally of Prime Minister Modi, his empire grew alongside India's nationalist turn. His ports, power plants, and media companies are woven into India's infrastructure‚Äîand its politics. American prosecutors say he corrupted both.`
        },
        koch: {
        name: "Charles Koch",
        short: "Koch",
        company: "Koch Industries",
        worth: "$66B",
        avatar: "CK",
        tagline: "Funded climate denial. The planet is paying.",
        sins: `<strong>Decades funding climate change denial</strong>‚Äîhundreds of millions to think tanks, politicians, and PR campaigns that delayed action while the planet warmed. The Koch network is the single largest force behind America's failure to address climate change.
        
        Spent hundreds of millions more fighting unions, environmental regulations, and voting rights. His political machine helped gerrymander state legislatures and stack courts. <strong>Dark money pioneer.</strong>
        
        Now 89, passing his fortune and influence to the next generation through dynasty tax avoidance. Koch Industries‚Äîoil, chemicals, paper‚Äîis one of America's top polluters. The family fortune, built on fossil fuels, will outlast us all.`
        },
        dimon: {
        name: "Jamie Dimon",
        short: "Dimon",
        company: "JPMorgan Chase",
        worth: "$2.6B",
        avatar: "JD",
        tagline: "Too big to fail. Too powerful to jail.",
        sins: `JPMorgan has paid <strong>over $35 billion in fines</strong> since 2008‚Äîmore than any bank in history. Fraud, market manipulation, mortgage abuses, sanctions violations. The cost of doing business when you're too big to fail.
        
        Reached a <strong>$290 million settlement</strong> over the bank's relationship with Jeffrey Epstein‚Äîyears after his first conviction. The bank continued servicing him anyway. Most powerful banker on Wall Street, treated as a statesman.
        
        Finances more fossil fuel projects than any other bank despite climate pledges. Trump reportedly considered him for Treasury Secretary. Whether red or blue, JPMorgan wins. The fines are just a line item.`
        }
    };
    
    const INITIAL_BRACKET = [
        ['musk', 'andreessen'],
        ['trump', 'sacks'],
        ['bezos', 'zuckerberg'],
        ['adelson', 'sun'],
        ['ellison', 'thiel'],
        ['zhao', 'murdoch'],
        ['schwarzman', 'adani'],
        ['koch', 'dimon']
    ];
    
    // ==========================================
    // STATE
    // ==========================================
    // State for the client.  We no longer persist the visitorId or votes between sessions
    // so that each page visit starts fresh and users can vote multiple times.  The visitorId is
    // generated for each session without being stored in localStorage, and previous votes are
    // not loaded from localStorage.
    let state = {
        visitorId: generateVisitorId(),
        email: localStorage.getItem('wb_email') || null,
        votes: {},
        selections: {},
        tournamentData: null,
        hasSubmittedThisRound: false
    };
    
    function generateVisitorId() {
        // Generate a unique identifier for this session.  We intentionally do not persist
        // the visitorId to localStorage so that each page visit is treated as a new user.
        const id = 'v_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        return id;
    }
    
    // ==========================================
    // TIME UTILITIES
    // ==========================================
    function getCurrentRound() {
        if (CONFIG.demo) return CONFIG.demoRound;
        
        const now = new Date();
        for (let i = 0; i < CONFIG.rounds.length; i++) {
            const start = new Date(CONFIG.rounds[i].start);
            const end = new Date(CONFIG.rounds[i].end);
            if (now >= start && now <= end) return i + 1;
        }
        
        if (now < new Date(CONFIG.rounds[0].start)) return 0; // Not started
        if (now > new Date(CONFIG.rounds[3].end)) return 5; // Finished
        
        // Between rounds
        for (let i = 0; i < 3; i++) {
            const end = new Date(CONFIG.rounds[i].end);
            const nextStart = new Date(CONFIG.rounds[i + 1].start);
            if (now > end && now < nextStart) return -(i + 2);
        }
        
        return 1;
    }
    
    function getTimeRemaining(endDate) {
        const diff = new Date(endDate) - new Date();
        if (diff <= 0) return { days: 0, hours: 0, mins: 0, secs: 0 };
        
        return {
            days: Math.floor(diff / 86400000),
            hours: Math.floor((diff % 86400000) / 3600000),
            mins: Math.floor((diff % 3600000) / 60000),
            secs: Math.floor((diff % 60000) / 1000)
        };
    }
    
    // ==========================================
    // API (works without backend - stores locally)
    // ==========================================
    async function fetchTournament() {
        // If no API configured, use mock data with local vote counts
        if (!CONFIG.apiUrl) {
            return generateLocalTournamentData();
        }

        try {
            const res = await fetch(`${CONFIG.apiUrl}/tournament`, { cache: "no-store" });
            if (!res.ok) {
                throw new Error(`Failed to fetch tournament: ${res.statusText}`);
            }
            const json = await res.json();
            // Validate that matchups exist and have at least one entry; otherwise fallback to local
            if (json && json.matchups && typeof json.matchups === 'object' && Object.keys(json.matchups).length > 0) {
                return json;
            }
            // Fallback to local data if no matchups or invalid structure
            return generateLocalTournamentData();
        } catch (e) {
            console.error('API error:', e);
            return generateLocalTournamentData();
        }
    }
    
    function generateLocalTournamentData() {
        const round = getCurrentRound();
        const data = {
            round,
            totalVotes: parseInt(localStorage.getItem('wb_totalVotes') || '0') + Math.floor(Math.random() * 500) + 100,
            matchups: {},
            results: {}
        };
        
        // Round 0 = pre-tournament, just show bracket preview
        if (round <= 0) {
            INITIAL_BRACKET.forEach((pair, i) => {
                data.matchups[`r1m${i+1}`] = { id: `r1m${i+1}`, candidates: pair };
            });
            return data;
        }
        
        // Generate matchups for current round
        if (round === 1) {
            INITIAL_BRACKET.forEach((pair, i) => {
                data.matchups[`r1m${i+1}`] = { id: `r1m${i+1}`, candidates: pair };
            });
        } else if (round <= 4) {
            // For rounds 2-4, we'd need real results - for now show mock advancement
            const advancers = ['musk', 'bezos', 'zuckerberg', 'ellison', 'thiel', 'murdoch', 'adani', 'trump'];
            const numMatchups = 8 / Math.pow(2, round - 1);
            for (let i = 0; i < numMatchups * 2 && i < advancers.length; i += 2) {
                data.matchups[`r${round}m${Math.floor(i/2)+1}`] = {
                    id: `r${round}m${Math.floor(i/2)+1}`,
                    candidates: [advancers[i], advancers[i+1]]
                };
            }
        }
        
        // Generate mock past results for display
        const pastWinners = ['musk', 'bezos', 'zuckerberg', 'ellison', 'thiel', 'murdoch', 'adani', 'trump'];
        const pastLosers = ['cook', 'dimon', 'arnault', 'koch', 'ballmer', 'page', 'brin', 'schwarzman'];
        
        for (let r = 1; r < round && r <= 4; r++) {
            const numResults = 8 / Math.pow(2, r - 1);
            data.results[r] = [];
            for (let i = 0; i < numResults; i++) {
                data.results[r].push({
                    winner: pastWinners[i % pastWinners.length],
                    loser: pastLosers[i % pastLosers.length],
                    winnerVotes: Math.floor(Math.random() * 5000) + 3000,
                    loserVotes: Math.floor(Math.random() * 3000) + 1000
                });
            }
        }
        
        return data;
    }
    
    async function submitVotes(selections) {
        console.log('Submitting votes:', { visitorId: state.visitorId, selections });

        // Try to send to API if configured
        if (CONFIG.apiUrl) {
            // Generate email from visitorId if user hasn't provided one
            const emailForBackend = state.email || `${state.visitorId}@example.invalid`;
            const payload = {
                email: emailForBackend,
                votes: selections
            };
            try {
                const res = await fetch(`${CONFIG.apiUrl}/votes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    throw new Error(`Failed to submit votes: ${res.statusText}`);
                }

                const result = await res.json();

                // Log skipped votes for debugging
                if (result.skipped && result.skipped.length > 0) {
                    console.log('Skipped duplicate votes for matchups:', result.skipped);
                }
            } catch (e) {
                console.error('Submit error:', e);
                // Continue anyway - we'll save locally
            }
        }

        // Always save locally
        const currentTotal = parseInt(localStorage.getItem('wb_totalVotes') || '0');
        localStorage.setItem('wb_totalVotes', currentTotal + Object.keys(selections).length);
        // Save locally - merge selections into existing round votes
        const round = getCurrentRound();
        state.votes[`round${round}`] = { ...(state.votes[`round${round}`] || {}), ...selections };
        localStorage.setItem('wb_votes', JSON.stringify(state.votes));
        // Mark this round as submitted in state only.  We no longer persist this flag so
        // that future visits to the site start with a fresh ballot.  Users can still
        // submit multiple times by refreshing or returning later.
        state.hasSubmittedThisRound = true;
        return { success: true };
    }
    
    async function submitEmail(email, name, zip, optIn) {
        console.log('Submitting email:', { email, name, zip, optIn });

        // Try to send to API if configured
        if (CONFIG.apiUrl) {
            try {
                const res = await fetch(`${CONFIG.apiUrl}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, name, zip, optIn })
                });

                if (!res.ok) {
                    throw new Error(`Failed to register: ${res.statusText}`);
                }

                await res.json();
            } catch (e) {
                console.error('Email error:', e);
            }
        }

        // Always save locally
        state.email = email;
        localStorage.setItem('wb_email', email);

        return { success: true };
    }
    
    // ==========================================
    // RENDER FUNCTIONS
    // ==========================================
    function render() {
        const round = getCurrentRound();
        const main = document.getElementById('mainContent');
        
        // Update header
        updateStatusBar(round);
        
        if (round === 0) {
            renderPreTournament();
        } else if (round === 5) {
            renderFinalWinner();
        } else if (round < 0) {
            renderBetweenRounds(Math.abs(round));
        } else {
            renderVoting(round);
        }
    }
    
    function updateStatusBar(round) {
        const badge = document.getElementById('badgeText');
        const roundEl = document.getElementById('roundDisplay');
        const votesEl = document.getElementById('votesDisplay');
        const statusEl = document.getElementById('statusDisplay');
        
        votesEl.textContent = state.tournamentData?.totalVotes?.toLocaleString() || '‚Äî';
        
        if (round === 0) {
            badge.textContent = 'COMING SOON';
            roundEl.textContent = 'Pre-season';
            statusEl.textContent = 'Opens Jan 6';
            statusEl.className = 'status-value';
        } else if (round === 5) {
            badge.textContent = 'TOURNAMENT COMPLETE';
            roundEl.textContent = 'Finished';
            statusEl.textContent = 'Complete';
            statusEl.className = 'status-value';
        } else if (round < 0) {
            badge.textContent = 'BETWEEN ROUNDS';
            roundEl.textContent = CONFIG.rounds[Math.abs(round) - 1].name;
            statusEl.textContent = 'Results In';
            statusEl.className = 'status-value';
        } else {
            badge.textContent = 'VOTING OPEN';
            roundEl.textContent = CONFIG.rounds[round - 1].name;
            statusEl.textContent = 'Live';
            statusEl.className = 'status-value live';
        }
    }
    
    function renderPreTournament() {
        const main = document.getElementById('mainContent');
        main.innerHTML = `
            <div class="countdown-wrap">
                <div class="countdown-label">VOTING BEGINS IN</div>
                <div class="countdown" id="countdown"></div>
            </div>
            
            <div class="section-header">
                <h2 class="section-title">The Contenders</h2>
                <p class="section-subtitle">16 billionaires enter. 1 will be crowned the worst.</p>
            </div>
            
            <div class="matchups-grid">
                ${INITIAL_BRACKET.map((pair, i) => `
                    <div class="matchup-card">
                        <div class="matchup-header">
                            <span class="matchup-num">MATCHUP ${i + 1}</span>
                            <span class="matchup-status">ROUND 1</span>
                        </div>
                        <div class="matchup-body">
                            ${pair.map(id => renderCandidatePreview(id)).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
            
            ${!state.email ? `
                <div class="submit-section" style="border: 1px solid var(--border); border-radius: 12px; margin: 40px 0; padding: 50px 20px;">
                    <div class="thank-you-icon">üîî</div>
                    <h3 class="section-title" style="margin: 20px 0 10px;">Get Notified When Voting Opens</h3>
                    <p style="color: var(--gray-light); margin-bottom: 30px;">Be the first to cast your vote on January 6th.</p>
                    <form class="email-form" name="notify-signup" method="POST" data-netlify="true" netlify-honeypot="bot-field" onsubmit="handleEmailSubmit(event)">
                        <input type="hidden" name="form-name" value="notify-signup">
                        <input type="hidden" name="bot-field">
                        <input type="hidden" name="signup-type" value="pre-tournament">
                        <div class="form-field">
                            <input type="email" class="form-input" id="emailInput" name="email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="optIn" name="opt-in" value="yes" checked>
                            <label for="optIn">Keep me updated on billionaire accountability</label>
                        </div>
                        <button type="submit" class="btn btn-primary form-submit">Notify Me ‚Üí</button>
                    </form>
                </div>
            ` : `
                <div class="submit-section" style="border: 1px solid var(--green); border-radius: 12px; margin: 40px 0; padding: 40px 20px; background: rgba(0,255,127,0.05);">
                    <p style="color: var(--green); font-size: 1.1rem;">‚úì You'll be notified when voting opens!</p>
                </div>
            `}
            
            <div class="share-strip">
                <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share</button>
                <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                <button class="share-btn email" onclick="shareEmail()">Email</button>
                <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
            </div>
        `;
        
        startCountdown(CONFIG.rounds[0].start);
    }
    
    function renderCandidatePreview(id) {
        const b = BILLIONAIRES[id];
        return `
            <div class="candidate disabled">
                <div class="candidate-avatar">${b.avatar}</div>
                <div class="candidate-info">
                    <div class="candidate-name">${b.name}</div>
                    <div class="candidate-meta">${b.company}</div>
                </div>
            </div>
        `;
    }
    
    function renderVoting(round) {
        const main = document.getElementById('mainContent');
        const matchups = Object.values(state.tournamentData?.matchups || {});
        const roundConfig = CONFIG.rounds[round - 1];
        const prevVotes = state.votes[`round${round}`] || {};
        const hasVotedAll = Object.keys(prevVotes).length === matchups.length;
        // We intentionally do not check for a previous submission so that the user always
        // starts with a fresh ballot each time they visit the site.
        
        main.innerHTML = `
            ${renderScheduleAndExplainer()}
            <div class="countdown-wrap">
                <div class="countdown-label">VOTING CLOSES IN</div>
                <div class="countdown" id="countdown"></div>
            </div>
            
            <div class="section-header">
                <h2 class="section-title">${roundConfig.name}</h2>
                <p class="section-subtitle">Pick the <strong>worse</strong> billionaire in each matchup</p>
            </div>
            
            <div class="matchups-grid" id="matchupsGrid">
                ${matchups.map((m, i) => renderMatchupCard(m, i, prevVotes[m.id])).join('')}
            </div>
            
            <div class="submit-section" id="submitSection">
                ${state.hasSubmittedThisRound ? renderThankYou() : renderSubmitArea(matchups.length)}
            </div>
            
            ${renderPastRounds()}
        `;
        
        startCountdown(roundConfig.end);
    }
    
    function renderMatchupCard(matchup, index, votedFor) {
        // Treat the matchup as complete if the user has submitted any vote this round
        const hasVoted = !!votedFor || state.hasSubmittedThisRound;
        const selected = state.selections[matchup.id];
        
        return `
            <div class="matchup-card ${hasVoted ? 'complete' : ''}">
                <div class="matchup-header">
                    <span class="matchup-num">MATCHUP ${index + 1}</span>
                    <span class="matchup-status ${hasVoted ? 'voted' : 'open'}">${hasVoted ? '‚úì VOTED' : 'VOTE NOW'}</span>
                </div>
                <div class="matchup-body">
                    ${matchup.candidates.map(id => {
                        const b = BILLIONAIRES[id];
                        let classes = 'candidate';
                        if (hasVoted) {
                            classes += ' disabled';
                            if (votedFor === id) classes += ' selected';
                        } else {
                            if (selected === id) classes += ' selected';
                        }
                        
                        return `
                            <div class="${classes}" onclick="selectCandidate('${matchup.id}', '${id}', ${hasVoted})">
                                <div class="candidate-avatar">${b.avatar}</div>
                                <div class="candidate-info">
                                    <div class="candidate-name">${b.name}</div>
                                    <div class="candidate-meta">${b.worth} ¬∑ ${b.company.split('¬∑')[0].trim()}</div>
                                </div>
                                <div class="candidate-check">${(selected === id || votedFor === id) ? '‚úì' : ''}</div>
                            </div>
                        `;
                    }).join('')}
                    
                    <button class="sins-toggle" onclick="toggleSins('${matchup.id}')">
                        What did they do? ‚Üì
                    </button>
                    <div class="sins-content" id="sins-${matchup.id}">
                        ${matchup.candidates.map(id => `
                            <h4>${BILLIONAIRES[id].name}</h4>
                            <p>${BILLIONAIRES[id].sins}</p>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    
    function renderSubmitArea(totalMatchups) {
        const numSelected = Object.keys(state.selections).length;
        const canSubmit = numSelected > 0;
        
        return `
            <p class="votes-summary">
                <strong>${numSelected}</strong> of ${totalMatchups} matchups selected
            </p>
            <button class="btn btn-primary btn-large" onclick="handleSubmitVotes()" ${canSubmit ? '' : 'disabled'}>
                Submit ${numSelected > 0 ? numSelected : ''} Vote${numSelected !== 1 ? 's' : ''} ‚Üí
            </button>
            <div class="share-strip">
                <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share</button>
                <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                <button class="share-btn email" onclick="shareEmail()">Email</button>
                <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
            </div>
        `;
    }
    
    function renderThankYou() {
        return `
            <div class="thank-you show">
                <div class="thank-you-icon">üó≥Ô∏è</div>
                <div class="thank-you-title">Votes Recorded!</div>
                <p class="thank-you-text">
                    Your voice has been heard. Want to see how everyone else is voting?
                </p>
                
                ${state.email ? `
                    <p style="color: var(--green); margin-bottom: 30px;">‚úì You'll be notified when results are in</p>
                    <div class="share-strip">
                        <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share</button>
                        <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                        <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                        <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                        <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                        <button class="share-btn email" onclick="shareEmail()">Email</button>
                        <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                        <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
                    </div>
                ` : `
                    <form class="email-form" name="voter-signup" method="POST" data-netlify="true" netlify-honeypot="bot-field" onsubmit="handleEmailSubmit(event)">
                        <input type="hidden" name="form-name" value="voter-signup">
                        <input type="hidden" name="bot-field">
                        <input type="hidden" name="signup-type" value="post-vote">
                        <div class="form-title">üîì Unlock Live Results</div>
                        <div class="form-field">
                            <input type="email" class="form-input" id="emailInput" name="email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-row">
                            <input type="text" class="form-input" id="nameInput" name="name" placeholder="Name (optional)">
                            <input type="text" class="form-input" id="zipInput" name="zip" placeholder="ZIP (optional)">
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="optIn" name="opt-in" value="yes" checked>
                            <label for="optIn">Keep me updated on billionaire accountability</label>
                        </div>
                        <button type="submit" class="btn btn-primary form-submit">Show Me Results ‚Üí</button>
                    </form>
                    <a href="#" class="form-skip" onclick="skipEmail(); return false;">Maybe later</a>
                    <div class="share-strip" style="margin-top: 30px;">
                        <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share</button>
                        <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                        <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                        <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                        <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                        <button class="share-btn email" onclick="shareEmail()">Email</button>
                        <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                        <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
                    </div>
                `}
            </div>
        `;
    }
    
    function renderBetweenRounds(nextRound) {
        const main = document.getElementById('mainContent');
        const prevRoundResults = state.tournamentData?.results?.[nextRound - 1] || [];
        const nextConfig = CONFIG.rounds[nextRound - 1];
        
        main.innerHTML = `
            <div class="countdown-wrap">
                <div class="countdown-label">${nextConfig.name.toUpperCase()} BEGINS IN</div>
                <div class="countdown" id="countdown"></div>
            </div>
            
            <div class="section-header">
                <h2 class="section-title">${CONFIG.rounds[nextRound - 2].name} Results</h2>
                <p class="section-subtitle">Here's who advanced</p>
            </div>
            
            <div class="matchups-grid">
                ${prevRoundResults.map((r, i) => renderResultCard(r, i)).join('')}
            </div>
            
            ${!state.email ? `
                <div class="submit-section">
                    <form class="email-form" name="round-notify" method="POST" data-netlify="true" netlify-honeypot="bot-field" onsubmit="handleEmailSubmit(event)">
                        <input type="hidden" name="form-name" value="round-notify">
                        <input type="hidden" name="bot-field">
                        <input type="hidden" name="signup-type" value="between-rounds">
                        <div class="form-title">Get notified for ${nextConfig.name}</div>
                        <div class="form-field">
                            <input type="email" class="form-input" id="emailInput" name="email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="optIn" name="opt-in" value="yes" checked>
                            <label for="optIn">Keep me updated on billionaire accountability</label>
                        </div>
                        <button type="submit" class="btn btn-primary form-submit">Notify Me ‚Üí</button>
                    </form>
                </div>
            ` : ''}
            
            <div class="share-strip">
                <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share Results</button>
                <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                <button class="share-btn email" onclick="shareEmail()">Email</button>
                <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
            </div>
            
            ${renderPastRounds()}
        `;
        
        startCountdown(nextConfig.start);
    }
    
    function renderResultCard(result, index) {
        const winner = BILLIONAIRES[result.winner];
        const loser = BILLIONAIRES[result.loser];
        const total = result.winnerVotes + result.loserVotes;
        const winPct = Math.round((result.winnerVotes / total) * 100);
        const losePct = 100 - winPct;
        
        return `
            <div class="matchup-card">
                <div class="matchup-header">
                    <span class="matchup-num">MATCHUP ${index + 1}</span>
                    <span class="matchup-status closed">COMPLETE</span>
                </div>
                <div class="matchup-body">
                    <div class="candidate winner disabled">
                        <div class="candidate-avatar">${winner.avatar}</div>
                        <div class="candidate-info">
                            <div class="candidate-name">${winner.name}</div>
                            <div class="candidate-meta">Advances ‚Üí</div>
                        </div>
                        <div class="candidate-check">üëë</div>
                    </div>
                    <div class="candidate loser disabled">
                        <div class="candidate-avatar" style="opacity: 0.5">${loser.avatar}</div>
                        <div class="candidate-info">
                            <div class="candidate-name">${loser.name}</div>
                            <div class="candidate-meta">Eliminated</div>
                        </div>
                    </div>
                    
                    <div class="results-bar">
                        <div class="result-row">
                            <span class="result-name">${winner.short}</span>
                            <div class="result-track">
                                <div class="result-fill winner" style="width: ${winPct}%"></div>
                            </div>
                            <span class="result-pct winner">${winPct}%</span>
                        </div>
                        <div class="result-row">
                            <span class="result-name">${loser.short}</span>
                            <div class="result-track">
                                <div class="result-fill loser" style="width: ${losePct}%"></div>
                            </div>
                            <span class="result-pct">${losePct}%</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    function renderFinalWinner() {
        const main = document.getElementById('mainContent');
        const finalResult = state.tournamentData?.results?.[4]?.[0];
        
        if (!finalResult) {
            main.innerHTML = '<p style="text-align:center;padding:100px;">Loading final results...</p>';
            return;
        }
        
        const winner = BILLIONAIRES[finalResult.winner];
        
        // Trigger confetti
        setTimeout(launchConfetti, 500);
        
        main.innerHTML = `
            <div class="winner-section">
                <div class="winner-label">THE PEOPLE HAVE SPOKEN</div>
                <div class="winner-trophy">üèÜ</div>
                <div class="winner-name">${winner.name}</div>
                <p class="winner-stats">
                    <strong>${state.tournamentData.totalVotes.toLocaleString()}</strong> total votes ¬∑
                    <strong>${winner.worth}</strong> net worth
                </p>
            </div>
            
            <div class="share-strip" style="padding: 50px 0;">
                <button class="share-btn twitter" onclick="shareTwitter()">ùïè Share the Verdict</button>
                <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
                <button class="share-btn linkedin" onclick="shareLinkedIn()">LinkedIn</button>
                <button class="share-btn reddit" onclick="shareReddit()">Reddit</button>
                <button class="share-btn bluesky" onclick="shareBluesky()">Bluesky</button>
                <button class="share-btn email" onclick="shareEmail()">Email</button>
                <button class="share-btn download" onclick="downloadShareImage()">üñºÔ∏è Image</button>
                <button class="share-btn copy" onclick="copyLink()">üîó Copy Link</button>
            </div>
            
            ${renderPastRounds()}
        `;
    }
    
    function renderPastRounds() {
        const results = state.tournamentData?.results || {};
        const rounds = Object.keys(results).sort((a, b) => b - a);
        
        if (rounds.length === 0) return '';
        
        return `
            <div class="past-rounds">
                <div class="section-header">
                    <h2 class="section-title">Past Rounds</h2>
                </div>
                ${rounds.map(r => {
                    const roundResults = results[r];
                    const config = CONFIG.rounds[r - 1];
                    return `
                        <div class="past-round" onclick="togglePastRound(this)">
                            <div class="past-round-header">
                                <div>
                                    <div class="past-round-title">${config.name}</div>
                                    <div class="past-round-meta">${roundResults.length} matchups completed</div>
                                </div>
                                <div class="past-round-toggle">‚ñº</div>
                            </div>
                            <div class="past-round-content">
                                ${roundResults.map(res => `
                                    <div class="past-matchup">
                                        <div class="past-matchup-icon">üëë</div>
                                        <div class="past-matchup-info">
                                            <div class="past-matchup-winner">${BILLIONAIRES[res.winner].name}</div>
                                            <div class="past-matchup-loser">beat ${BILLIONAIRES[res.loser].name}</div>
                                        </div>
                                        <div class="past-matchup-votes">${res.winnerVotes.toLocaleString()} - ${res.loserVotes.toLocaleString()}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }
    
    // ==========================================
    // EVENT HANDLERS
    // ==========================================
    function selectCandidate(matchupId, candidateId, hasVoted) {
        if (hasVoted) return;
        
        state.selections[matchupId] = candidateId;
        render();
    }
    
    function toggleSins(matchupId) {
        const el = document.getElementById(`sins-${matchupId}`);
        el.classList.toggle('show');
    }
    
    function togglePastRound(el) {
        el.classList.toggle('open');
    }
    
    async function handleSubmitVotes() {
        if (Object.keys(state.selections).length === 0) {
            alert('Pick at least one matchup before submitting.');
            return;
        }
        
        const result = await submitVotes(state.selections);
        
        if (result.success) {
            // Merge selections into votes
            const round = getCurrentRound();
            state.votes[`round${round}`] = { ...state.votes[`round${round}`], ...state.selections };
            localStorage.setItem('wb_votes', JSON.stringify(state.votes));
            state.selections = {};
            render();
            
            // Scroll to thank you
            document.getElementById('submitSection').scrollIntoView({ behavior: 'smooth' });
        }
    }
    
    async function handleEmailSubmit(event) {
        event.preventDefault();
        
        const form = event.target;
        const email = document.getElementById('emailInput').value;
        const name = document.getElementById('nameInput')?.value || '';
        const zip = document.getElementById('zipInput')?.value || '';
        const optIn = document.getElementById('optIn')?.checked ?? true;
        
        // Submit to Netlify Forms
        try {
            const formData = new FormData(form);
            await fetch('/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(formData).toString()
            });
        } catch (e) {
            console.error('Form submission error:', e);
        }
        
        // Also save locally and update state
        await submitEmail(email, name, zip, optIn);
        render();
    }
    
    function skipEmail() {
        render();
    }
    
    // ==========================================
    // SHARING
    // ==========================================
    function shareTwitter() {
        const round = getCurrentRound();
        let text;
        
        if (round === 5 && state.tournamentData?.results?.[4]?.[0]) {
            const winner = BILLIONAIRES[state.tournamentData.results[4][0].winner].name;
            text = `The people have spoken: ${winner} is 2025's WORST BILLIONAIRE üèÜ\n\nSee the results:`;
        } else {
            text = `I'm voting in the Worst Billionaire 2025 tournament. Who's YOUR pick for worst?\n\n`;
        }
        
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(canonicalUrl())}`, '_blank');
    }
    
    function shareFacebook() {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(canonicalUrl())}`, '_blank');
    }
    
    function copyLink() {
        navigator.clipboard.writeText(canonicalUrl());
        alert('Link copied!');
    }
    
    function showPrivacy() {
        alert('Privacy: We use your email only to send results and updates you opt into. We never sell your data. Unsubscribe anytime.');
    }
    
    // ==========================================
    // COUNTDOWN
    // ==========================================
    let countdownInterval;
    
    function startCountdown(endDate) {
        if (countdownInterval) clearInterval(countdownInterval);
        
        function update() {
            const t = getTimeRemaining(endDate);
            const el = document.getElementById('countdown');
            if (el) {
                el.innerHTML = `
                    <div class="countdown-block"><div class="countdown-num">${t.days}</div><div class="countdown-unit">DAYS</div></div>
                    <div class="countdown-block"><div class="countdown-num">${t.hours}</div><div class="countdown-unit">HRS</div></div>
                    <div class="countdown-block"><div class="countdown-num">${t.mins}</div><div class="countdown-unit">MIN</div></div>
                    <div class="countdown-block"><div class="countdown-num">${t.secs}</div><div class="countdown-unit">SEC</div></div>
                `;
            }
        }
        
        update();
        countdownInterval = setInterval(update, 1000);
    }
    
    // ==========================================
    // CONFETTI
    // ==========================================
    function launchConfetti() {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const pieces = [];
        const colors = ['#ff2a2a', '#ffd700', '#ffffff', '#00ff7f'];
        
        for (let i = 0; i < 200; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                r: Math.random() * 6 + 3,
                color: colors[Math.floor(Math.random() * colors.length)],
                velocity: Math.random() * 3 + 2,
                angle: Math.random() * Math.PI * 2
            });
        }
        
        let frame = 0;
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            pieces.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.r, p.r * 1.5);
                p.y += p.velocity;
                p.x += Math.sin(p.angle + frame * 0.02) * 0.5;
            });
            
            frame++;
            if (frame < 400) requestAnimationFrame(draw);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        draw();
    }
    
    // ==========================================
    // INIT
    // ==========================================
    async function init() {
        state.tournamentData = await fetchTournament();
        
        // Always start each session with a fresh ballot. We do not carry over
        // any previous vote counts between visits, so the thank‚Äëyou state is
        // always reset to false on load.
        state.hasSubmittedThisRound = false;
        
        render();
    }
    
    init();
    </script>
</body>
</html>
